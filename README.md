# 'songs-server'
#### A basic server to provide a list of songs and some files
#### Generated by: Danielo Rodriguez
#### Keywords: rest,microservice

## This backend uses:

* Hapi
* Lab for testing
* Swagger for automatic endpoint documentation
* Good, good-squeeze and good-console for logging
* Nodemon for reloading the server when code changes
* Eslint with hapi configuration for code linting

### APIS

* Basic spotify api capabilities for cover image fetching
* The awesome and open source [Music Demons API](https://musicdemons.com/api)

## Get things running

* Start the server `npm start`
    * To start on production mode `npm run start-prod`. On production mode songs URLs will be pointing the cdn
    * Start the server on dev mode `npm run start-dev`
* Documentation is available at `/documentation` route
* Run tests `npm test`
* With the server running, open `http://localhost:3001/ops/version` to see the version of your package
* With the server running, open `http://localhost:3001/documentation` to see the documentation of your API

## Authentication

This backend requires some auth configuration in order to work, if it is not provided it will stop with a descriptive error message.
It uses the Spotify API, so you need to provide basic app credentials for it.
It is as easy as creating a file called `.spotifyrc` (watch the dot (.) prefix) with the following content

```ini
clientId="your-app-client-id"
clientSecret="your-app-client-secret"
```

We do not use any API feature that requires user authorization, so this is all what is needed.

## Tooling

During development some tools have been developed to help with the task of metadata collection and media gathering.
All the scripts contained here are just for development and investigation purposes only.
They are not meant for abuse any of the involved API or for getting content with copyright.

### downloadMedia.js

This script uses the Music Demons API to get a list of artist, a list of songs of those artists and then it tries to download them from youtube.
Songs are downloaded one by one to avoid abuse, and Music Demons is fetched in series (not in parallel) to not stress the API.
The quality of the resultant files is not guaranteed.
To execute it just run  `node ./bin/downloadMedia.js` at the root of the repository.
You can provide one or two optional positional arguments, meaning:
* The first one is the number of artist from the Music Demons API to skip, useful if you want to resume. Defaults to `0`
* The second one is the number of artist to try to get songs of. Defaults to `20`

## Docker

This service can run as a Docker container. To do this you need docker installed on your machine.
This repository contains some npm scripts to help you:

* `npm run build` builds the docker image with the current repository version as tag
* `npm run docker-push` push the current image to the docker repository. This will use whatever you have configured on your machine as repository
* `npm run deploy` builds the  docker image and then push it to the docker repository